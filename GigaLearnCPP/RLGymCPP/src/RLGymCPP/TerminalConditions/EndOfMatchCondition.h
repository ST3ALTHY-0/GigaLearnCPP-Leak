#pragma once
#include "TerminalCondition.h"

namespace RLGC {
	// Simple fixed-duration terminal condition.
	// Terminates when the elapsed episode time >= maxTimeSeconds (default 300s).
	class EndOfMatchCondition : public TerminalCondition {
	public:
		float maxTimeSeconds = 300.0f; // default 5 minutes
		float elapsed = 0.0f;

		EndOfMatchCondition(float maxTimeSeconds_ = 300.0f) : maxTimeSeconds(maxTimeSeconds_), elapsed(0.0f) {}

		virtual void Reset(const GameState& initialState) override {
			// reset elapsed time to 0
			elapsed = 0.0f;
		}

		virtual bool IsTerminal(const GameState& currentState) override {
			// accumulate time using the state's deltaTime
			elapsed += currentState.deltaTime;
			// If we haven't reached the max time, not terminal
			if (elapsed < maxTimeSeconds)
				return false;
			// If time has elapsed, end the match only if the score is not tied.
			// If scores are tied, continue play (sudden-death overtime) until one
			// team takes the lead.
			if (currentState.score[0] != currentState.score[1])
				return true;
			return false;
		}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		virtual bool IsTruncation() override {
			return true;
		}
	};
}